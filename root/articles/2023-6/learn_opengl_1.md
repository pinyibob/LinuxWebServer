# 现代opengl编程

笔者学习opengl的项目时，由于使用的chatgpt和github上一些较久远的项目，导致走了一些弯路，对于2023年的今天，opengl编程应该以核心配置文件模式为主；
推荐学习网站[learn_opengl](https://learnopengl.com/Getting-started/Hello-Window)

opengl是一种规范和技术标准，不同系统上会有不同实现；代码编译时需要连接对应的opengl函数，由于版本的不同会导致连接麻烦，故可以使用中间库glew，glad（推荐）；

## 核心模式与立即渲染模式
在过去，使用 OpenGL 意味着以即时模式（通常称为固定函数管道）进行开发，这是一种易于使用的图形绘制方法。OpenGL的大部分功能都隐藏在库中，开发人员无法控制OpenGL如何进行计算。开发人员最终渴望更大的灵活性，随着时间的推移，规范变得更加灵活;开发人员可以更好地控制他们的图形。即时模式确实易于使用和理解，但它的效率也极低。出于这个原因，该规范从3.2版本开始弃用即时模式功能，并开始激励开发人员在OpenGL的核心配置文件模式下进行开发，该模式是OpenGL规范的一个部门，删除了所有旧的弃用功能。

因此shader是现代opengl编程的一个核心内容；

## opengl的跨平台窗口界面
opengl需要一个跨操作系统图形界面，他们可以是 GLUT, SDL, SFML and GLFW；
由于 OpenGL 实际上只是一个标准/规范，因此由驱动程序制造商将规范实现到特定显卡支持的驱动程序。由于 
OpenGL 驱动程序有许多不同的版本，因此其大多数函数的位置在编译时是未知的，需要在运行时查询。然后，开发人员的任务是检索他/她需要的函数的位置，并将它们存储在函数指针中以供以后使用。 

## 什么是双缓冲buffer
单缓冲会出现闪屏问题，因为渲染通常按像素从左至右，从上至下，而渲染是需要时间的；当帧切换时，下一帧并未渲染好； 因此，双缓冲buffer可以在渲染的情况下轮替显示图像，写入图像内容，从而删除上述伪影。

## 屏幕擦除
显示一帧图片时，可能受上一帧内容影响，故需要擦除；需要擦除的内容可能有：
GL_COLOR_BUFFER_BIT, GL_DEPTH_BUFFER_BIT and GL_STENCIL_BUFFER_BIT.（glfw）

擦除的句法通常为 
```
glClearColor(0.2f, 0.3f, 0.3f, 1.0f);
glClear(GL_COLOR_BUFFER_BIT);
```

## 我们需要编程的内容

图形管道可以分为两个大部分：第一部分将 3D 坐标转换为 2D 坐标，第二部分将 2D 坐标转换为实际的彩色像素。

```
图形管道将一组 3D 坐标作为输入，并将它们转换为屏幕上的彩色 2D 像素。图形流水线可以分为几个步骤，每个步骤都需要前一步的输出作为其输入。由于它们的并行特性，当今的图形卡具有数千个小型处理核心，可以在图形管道内快速处理您的数据。处理核心在 GPU 上为流水线的每个步骤运行小程序。这些小程序叫做着色器.

其中一些着色器可由开发人员配置，这允许我们编写自己的着色器来替换现有的默认着色器。这使我们能够对管道的特定部分进行更细粒度的控制，并且由于它们在 GPU 上运行，它们还可以为我们节省宝贵的 CPU 时间。
```
[link](https://learnopengl.com/Getting-started/Hello-Triangle)

在现代 OpenGL 中，我们需要至少定义
1. 顶点着色器
2. 片段着色器（GPU 上没有默认的顶点/片段着色器）

这也是opengl学习路线很陡峭的原因。

## 在开始做基本绘制前需要知道的概念

### 归一化设备坐标 (NDC):

> NDC（Normalized Device Coordinate，标准化设备坐标）是OpenGL中的一种坐标系统，是视口坐标的最终表示形式。在图形渲染管线中，几何图形顶点经过多个变换后最终被映射到NDC上。

> OpenGL将NDC范围定义为x，y和z坐标在-1.0和1.0之间，其中x轴的负方向是屏幕左侧，y轴的负方向是屏幕底部，z轴的负方向是屏幕内部。因此，当OpenGL将所有顶点转换为NDC坐标时，我们可以通过应用透视除法把每个顶点的深度坐标从视图空间的z坐标归一化到[0,1]，这样就可以对其进行裁剪、深度测试和基于深度的着色了。

### VAO && VBO
VAO，全称为Vertex Array Object，顶点数组对象，是一个OpenGL对象，它存储了若干个顶点属性的状态，包括顶点的位置、颜色、法向量等。VAO可以看作是对顶点属性和顶点缓冲区对象的状态的封装，简化了在绘制时的操作。一旦配置好VAO，我们就可以存储它，以备下次使用。

VBO，全称为Vertex Buffer Object，顶点缓冲对象，是OpenGL中用于存储顶点数据的缓冲区对象，也是一个OpenGL对象。我们可以将顶点的属性数据储存在VBO中，并将VBO绑定到VAO上，这样所有跟顶点属性相关的操作都可以通过VAO传递给对应的VBO，从而提高了渲染效率。

简言之，VAO和VBO是紧密相关的，VAO记录了VBO的相关信息。当渲染时，我们先将VAO绑定到OpenGL上下文中，然后再绑定对应的VBO，并指定其读取方式和顶点属性信息。这样我们就可以准备好绘制所需要的数据，并且可以轻松地重用它们。